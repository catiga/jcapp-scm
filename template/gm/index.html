<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>[[${str}]] | 商品模型</title>
<link th:href="@{{sp}/css/bootstrap.min.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/font-awesome/css/font-awesome.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/animate.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="@{{sp}/css/style.css(sp=${pub_bucket})}" rel="stylesheet">
<link th:href="|${pub_bucket}/css/plugins/ladda/ladda-themeless.min.css|" rel="stylesheet">
<link th:href="|${pub_bucket}/css/plugins/sweetalert/sweetalert.css|" rel="stylesheet">
</head>

<body>
	<div id="wrapper">
		<div th:replace="../common/nav"></div>
		<div id="page-wrapper" class="gray-bg">
			<div th:replace="../common/top"></div>
			<div class="row wrapper border-bottom white-bg page-heading">
				<div class="col-sm-4">
					<h2>商品SKU模型管理</h2>
					<ol class="breadcrumb">
						<li><a href="javascript:;">Home</a></li>
						<li class="active"><strong>商品SKU模型列表</strong></li>
					</ol>
				</div>
			</div>
			
			<div class="row">
				<div class="col-lg-12 sku_main_area">
					<div class="wrapper wrapper-content animated fadeInUp">
						<div class="ibox">
							<div class="ibox-title">
								<h5>SKU模型信息</h5>
								<div class="ibox-tools">
									<a href="#add_gm" class="btn btn-primary btn-xs add_gm">添加SKU模型</a>
								</div>
							</div>
							<div class="ibox-content">
								<div class="table-responsive">
                                	<table class="table table-striped">
										<thead>
		                                    <tr>
												<th>识别码</th>
												<th>SKU模型名称</th>
												<th>SKU模型代码</th>
												<th>属性组</th>
												<th>添加时间</th>
	  											<th>操作</th>
		                                    </tr>
	                                    </thead>
										<tbody>
											<tr th:each="st:${sku_models}" th:attr_id="${st.id }">
												<td>[[${st.id }]]</td>
												<td>
													<a href="javascript:;">[[${st.m_name_cn }]]</a><br/> 
													<small>更新时间 [[${#dates.format(st.c_time, 'yyyy-MM-dd')}]]</small>
												</td>
												<td>[[${st.m_name_en }]]</td>
												<td><a href="javascript:;" class="sku_props" th:attr_id="${st.id}">[管理属性组]</a></td>
												<td>[[${#dates.format(st.a_time, 'yyyy-MM-dd')}]]</td>
												<td>
													<button data-style="zoom-in" class="ladda-button btn btn-primary btn-sm edit" th:attr_id="${st.id }"><i class="fa fa-pencil"></i> 编辑 </button>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="col-lg-4 sku_prop_area hide">
					<div class="wrapper wrapper-content animated fadeIn">
						<div class="row">
							<div class="col-lg-12">
								<div class="ibox float-e-margins">
									<div class="ibox-title">
										<h5>SKU属性组管理区</h5>
										<div class="ibox-tools">
											<a class="collapse-link"> <i class="fa fa-chevron-up"></i></a>
										</div>
									</div>
									<div class="ibox-content">
										<div class="row">
											<div class="col-lg-12" style="border-bottom:1px solid #e7eaec">
												<div class="col-md-6">
													<div class="form-group">
														<label for="title_name">SKU模型名称</label> 
														<input id="title_name" type="text" class="form-control" placeholder="编辑模型名称" />
													</div>
												</div>
												<div class="col-md-6">
													<div class="form-group">
														<label for="title_key">SKU模型代码</label>
														<input id="title_key" type="text" class="form-control" placeholder="编辑模型代码" />
													</div>
												</div>
											</div>
											
											<div class="col-lg-12">
												<h5>SKU属性组</h5>
												<div class="col-md-6">
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称1" class="form-control sku_prop_name"/>
													</div>
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称2" class="form-control sku_prop_name"/>
													</div>
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称3" class="form-control sku_prop_name"/>
													</div>
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称4" class="form-control sku_prop_name"/>
													</div>
												</div>
												<div class="col-md-6">
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称5" class="form-control sku_prop_name"/>
													</div>
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称6" class="form-control sku_prop_name"/>
													</div>
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称7" class="form-control sku_prop_name"/>
													</div>
													<div class="form-group">
														<label for="hideEasing">&nbsp;</label> 
														<input type="text" placeholder="属性名称8" class="form-control sku_prop_name"/>
													</div>
												</div>
											</div>
										</div>
										
										<div class="row m-t-lg">
											<div class="col-lg-12">
												<button type="button" data-style="zoom-in" class="ladda-button btn btn-primary" id="save_sku_props">保存</button>
												<button type="button" class="btn btn-white" id="shutdown_area">关闭</button>
											</div>
										</div>
		
										<div class="row m-t-lg">
											<div class="col-lg-12">
												<small>备注</small>
												<pre id="toastrOptions" class="p-m">管理SKU模型的属性组，可以添加八个属性值</pre>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<div th:replace="../common/foot"></div>
		</div>
	</div>
	
	<div id="templatemo-preferences-form" style="display:none;padding-left:15px;padding-right:15px">
		<div class="row">
			<div class="col-md-6 margin-bottom-15">
				<label for="mnamecn" class="control-label">SKU模型名称</label>
				<input type="text" class="form-control" id="mnamecn" value="">
			</div>
			<div class="col-md-6 margin-bottom-15">
				<label for="mnameen" class="control-label">SKU模型代码</label>
				<input type="text" class="form-control" id="mnameen" value="">
			</div>
		</div>
		<div class="row templatemo-form-buttons" style="margin-top:15px">
			<div class="col-md-12">
				<button data-style="zoom-in" class="ladda-button btn btn-primary save_gm" style="width:100%">保存</button>
			</div>
		</div>
	</div>
	
	<!-- Mainly scripts -->
	<script th:src="@{{sp}/js/jquery-2.1.1.js(sp=${pub_bucket})}"></script>
	<script th:src="@{{sp}/js/bootstrap.min.js(sp=${pub_bucket})}"></script>
	<script th:src="@{{sp}/js/plugins/metisMenu/jquery.metisMenu.js(sp=${pub_bucket})}"></script>
	<script th:src="@{{sp}/js/plugins/slimscroll/jquery.slimscroll.min.js(sp=${pub_bucket})}"></script>

	<!-- Custom and plugin javascript -->
	<script th:src="@{{sp}/js/inspinia.js(sp=${pub_bucket})}"></script>
	<script th:src="@{{sp}/js/plugins/pace/pace.min.js(sp=${pub_bucket})}"></script>
	
	<script th:src="@{{sp}/third/layer3/layer.js(sp=${pub_bucket})}" type="text/javascript"></script>
	
	<!-- Ladda -->
    <script th:src="|${pub_bucket}/js/plugins/ladda/spin.min.js|"></script>
    <script th:src="|${pub_bucket}/js/plugins/ladda/ladda.min.js|"></script>
    <script th:src="|${pub_bucket}/js/plugins/ladda/ladda.jquery.min.js|"></script>
    
    <script th:src="|${pub_bucket}/js/plugins/sweetalert/sweetalert.min.js|"></script>

	<script>
		$(document).ready(function() {

			$('#loading-example-btn').click(function() {
				btn = $(this);
				simpleLoad(btn, true)

				// Ajax example
				//                $.ajax().always(function () {
				//                    simpleLoad($(this), false)
				//                });

				simpleLoad(btn, false)
			});
		});

		function simpleLoad(btn, state) {
			if (state) {
				btn.children().addClass('fa-spin');
				btn.contents().last().replaceWith(" Loading");
			} else {
				setTimeout(function() {
					btn.children().removeClass('fa-spin');
					btn.contents().last().replaceWith(" Refresh");
				}, 2000);
			}
		}
	</script>
</body>

<script type="text/javascript">
$(function() {
	var id = 0;
	
	$(".add_gm").on("click", function() {
		id = 0;
		$("#mnamecn").val('');
		$("#mnameen").val('');
		layer.open({
			area : [ '60%', '80%'],
			type : 1,
			content : $("#templatemo-preferences-form")
		});
	});
	
	$(".edit").on("click", function() {
		$this = $(this);
		$this.ladda('start');
		$.get('/scm/gm/aj/view', {id:$(this).attr('attr_id')}, function(data) {
			$this.ladda('stop');
			if(data.available) {
				id = data.data.model.id;
				$("#mnamecn").val(data.data.model.m_name_cn);
				$("#mnameen").val(data.data.model.m_name_en);
				layer.open({
					area : [ '60%', '80%'],
					type : 1,
					content : $("#templatemo-preferences-form")
				});
			} else {
				var code = data.messages[0];
				var msg = "操作失败：" + code;
				layer.msg(msg, {icon: 2});
			}
		});
	});
	var l = $(".ladda-button").ladda();
	$(".save_gm").on("click", function() {
		var namecn = $.trim($("#mnamecn").val());
		var nameen = $.trim($("#mnameen").val());
		$this = $(this);
		$this.ladda('start');
		$.post('/scm/gm/aj/save', {id:id,namecn:namecn,nameen:nameen}, function(data) {
			$this.ladda('stop');
			if(data.available) {
				layer.alert('操作成功', {
			        skin: 'layui-layer-lan',
			        shift: 4 //动画类型
			    }, function(){
			    	location.reload();
			    });
			} else {
				var code = data.messages[0];
				var msg = "操作失败：" + code;
				layer.msg(msg, {icon: 2});
			}
		});
	});
	$(".sku_props").on("click", function() {
		$(".sku_prop_name").each(function() {$(this).val('');});
		$.get('/scm/gm/aj/view', {id:$(this).attr('attr_id')}, function(data) {
			if(data.available) {
				id = data.data.model.id;
				$("#title_name").val(data.data.model.m_name_cn);
				$("#title_key").val(data.data.model.m_name_en);
				$(".sku_prop_area").removeClass('hide');
				$(".sku_main_area").removeClass('col-lg-12');$(".sku_main_area").addClass('col-lg-8');
				for(x in data.data.props) {
					$(".sku_prop_name").eq(x).val(data.data.props[x].attr_k);
				}
			} else {
				var code = data.messages[0];
				var msg = "操作失败：" + code;
				layer.msg(msg, {icon: 2});
			}
		});
	});
	
	$("#save_sku_props").on("click", function() {
		var prop_value = null;
		$(".sku_prop_name").each(function() {
			var tmp_str = $.trim($(this).val());
			if(tmp_str!='') prop_value==null?prop_value=tmp_str:prop_value+=',' + tmp_str;
		});
		if(!prop_value) layer.msg('请输入属性名称', {icon: 2});
		else {
			$this = $(this);
			$this.ladda('start');
			$.post('/scm/gm/aj/save_props', {id:id,props:prop_value}, function(data) {
				$this.ladda('stop');
				if(data.available) {
					layer.alert('操作成功', {
				        skin: 'layui-layer-lan',
				        shift: 4 //动画类型
				    }, function(){
				    	location.reload();
				    });
				} else {
					var code = data.messages[0];
					var msg = "操作失败：" + code;
					layer.msg(msg, {icon: 2});
				}
			});
		}
	});
	
	$("#shutdown_area").on("click", function() {
		$('.sku_prop_area').addClass('hide');
		$(".sku_main_area").removeClass('col-lg-8');$(".sku_main_area").addClass('col-lg-12');
	})
});
</script>

</html>
